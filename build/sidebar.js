(()=>{"use strict";const e=window.wp.element,t=window.lodash,a=(window.wp.keycodes,window.wp.components),n=window.wp.editPost,r=window.wp.data,s=(window.wp.coreData,window.wp.editor,window.wp.url,window.wp.blocks),o=e=>{let t=(0,s.pasteHandler)({HTML:e});return(0,s.serialize)(t)};async function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"categories",t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)throw new Error("Name is required");const n=await async function(){const e=`/wp-json/wp/v2/${arguments.length>0&&void 0!==arguments[0]?arguments[0]:"categories"}?slug=${a=arguments.length>1?arguments[1]:void 0,a.toLowerCase().replace(/\s/g,"-")}`,t=await fetch(e);var a;if(!t.ok)throw new Error(`Failed to get category: ${t.statusText}`);const n=await t.json();return 0===n.length?[]:n[0]}(e,t);if(console.log(e,t,n),0!==n.length)return n;const r="/wp-json/wp/v2/"+e,s={name:t,description:a||""},o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":jarvisSettings.nonce},body:JSON.stringify(s)});if(201!==o.status)throw new Error(`Failed to create category: ${o.statusText}`);return await o.json()}function i(n){const[r,s]=(0,e.useState)(!1),[i,c]=(0,e.useState)(!1),[w,d]=(0,e.useState)(!1),[m,u]=(0,e.useState)(null);return(0,e.createElement)("div",{className:"crawled-article"},(0,e.createElement)("div",{className:"crawled-article-headline"},(0,e.createElement)("h3",null,(0,e.createElement)("a",{href:n.link,target:"_blank"},n.title)),(0,e.createElement)("ul",{className:"crawled-article-categories"},(0,e.createElement)("li",null,n.category)),(0,e.createElement)(a.Button,{isBusy:r,variant:"secondary",isSmall:!0,onClick:()=>{s(!0),fetch("/wp-json/jarvis/v1/crawler?url="+n.link,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{u(e.result),s(!1)})).catch((e=>{console.error(e),alert(e.message),s(!1)}))}},"Crawl"),null!==m&&(0,e.createElement)(a.Button,{isBusy:i,variant:"secondary",isSmall:!0,disabled:w,onClick:()=>{0==w&&(async e=>{c(!0),(0,t.has)(e,"title")&&!(0,t.isEmpty)(e.title)||console.error("The article must have a non-empty title."),(0,t.has)(m,"html")&&!(0,t.isEmpty)(m.html)||console.error("The article must have non-empty content."),(0,t.has)(e,"description")&&!(0,t.isEmpty)(e.description)||console.error("The article must have a non-empty description."),(0,t.has)(e,"tags")&&(0,t.isArray)(e.tags)&&!(0,t.isEmpty)(e.tags)||console.error("The article must have a non-empty tags array."),(0,t.has)(e,"category")&&!(0,t.isEmpty)(e.category)||console.error("The article must have a non-empty category.");let a=await l("categories",e.category),n=e.tags.map((e=>e.term));n=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"categories";const t=(arguments.length>1?arguments[1]:void 0).map((async t=>l(e,t)));return await Promise.all(t)}("tags",n),n=n.map((e=>e.id));const r={title:e.title,content:o(m.html),excerpt:e.description,meta:{crawled_domain:(0,t.get)(m,"domain",""),crawled_keywords:(0,t.get)(m,"keywords",""),crawled_summary:(0,t.get)(m,"summary",""),crawled_author:(0,t.get)(e,"author","")},tags:n,categories:[a.id],status:"draft"};fetch("/wp-json/wp/v2/posts",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":jarvisSettings.nonce},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{console.log(e),d(!0),c(!1)}))})(n)}},w?"Draft Created":"Create Draft")))}function c(t){const{articles:a}=t;return 0==a.length?null:(0,e.createElement)("ul",{className:"crawled-articles"},a.map((t=>(0,e.createElement)("li",null,(0,e.createElement)(i,t)))))}function w(){const[t,s]=(0,e.useState)(!1),[o,l]=(0,e.useState)([]),i=(0,r.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").site_url)),{editPost:w}=(0,r.useDispatch)("core/editor");return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.PluginSidebarMoreMenuItem,{target:"news-crawler"},"News Crawler"),(0,e.createElement)(n.PluginSidebar,{className:"news-crawler-sidebar",name:"news-crawler",title:"Easy Attachments",icon:"admin-site-alt2"},(0,e.createElement)(a.TextControl,{label:"Site Url",value:i,onChange:e=>{w({meta:{site_url:e}})}}),(0,e.createElement)(a.Button,{isBusy:t,className:"news-crawler-button",variant:"primary",onClick:()=>{s(!0),fetch(`https://thedailytokennews.com/crawler/feed?url=${i}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{console.log(e),l(e),s(!1)})).catch((e=>{console.error(e),alert(e.message),s(!1),l([])}))}},"Get Articles"),(0,e.createElement)(c,{articles:o})))}const{registerPlugin:d}=wp.plugins;d("news-crawler-sidebar",{render:function(){return(0,e.createElement)(w,null)}})})();