(()=>{"use strict";const e=window.wp.element,t=window.lodash,a=(window.wp.keycodes,window.wp.components),r=window.wp.editPost,n=window.wp.data,l=(window.wp.coreData,window.wp.editor,window.wp.url,window.wp.blocks),s=e=>{let t=(0,l.pasteHandler)({HTML:e});return(0,l.serialize)(t)};function o(r){const[n,l]=(0,e.useState)(!1),[o,c]=(0,e.useState)(!1),[i,m]=(0,e.useState)(!1),[d,u]=(0,e.useState)(null);return(0,e.createElement)("div",{className:"crawled-article"},(0,e.createElement)("div",{className:"crawled-article-headline"},(0,e.createElement)("h3",null,(0,e.createElement)("a",{href:r.link,target:"_blank"},r.title)),(0,e.createElement)("ul",{className:"crawled-article-categories"},(0,e.createElement)("li",null,r.category)),(0,e.createElement)(a.Button,{isBusy:n,variant:"secondary",isSmall:!0,onClick:()=>{l(!0),fetch("/wp-json/jarvis/v1/crawler?url="+r.link,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{u(e.result),l(!1)})).catch((e=>{console.error(e),alert(e.message),l(!1)}))}},"Crawl"),null!==d&&(0,e.createElement)(a.Button,{isBusy:o,variant:"secondary",isSmall:!0,disabled:i,onClick:()=>{0==i&&(async e=>{c(!0),(0,t.has)(e,"title")&&!(0,t.isEmpty)(e.title)||console.error("The article must have a non-empty title."),(0,t.has)(d,"html")&&!(0,t.isEmpty)(d.html)||console.error("The article must have non-empty content."),(0,t.has)(e,"description")&&!(0,t.isEmpty)(e.description)||console.error("The article must have a non-empty description."),(0,t.has)(e,"tags")&&(0,t.isArray)(e.tags)&&!(0,t.isEmpty)(e.tags)||console.error("The article must have a non-empty tags array."),(0,t.has)(e,"category")&&!(0,t.isEmpty)(e.category)||console.error("The article must have a non-empty category.");let a=e.tags.map((e=>e.term));const r={title:e.title,content:s(d.html),excerpt:e.description,meta:{crawled_domain:(0,t.get)(d,"domain",""),crawled_categories:e.category,crawled_tags:a,crawled_summary:(0,t.get)(d,"summary",""),crawled_author:(0,t.get)(e,"author","")},status:"draft"};fetch("/wp-json/wp/v2/posts",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":jarvisSettings.nonce},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{console.log(e),m(!0),c(!1)}))})(r)}},i?"Draft Created":"Create Draft")))}function c(t){const{articles:a}=t;return 0==a.length?null:(0,e.createElement)("ul",{className:"crawled-articles"},a.map((t=>(0,e.createElement)("li",null,(0,e.createElement)(o,t)))))}function i(){const[t,l]=(0,e.useState)(!1),[s,o]=(0,e.useState)([]),i=(0,n.useSelect)((e=>e("core/editor").getEditedPostAttribute("meta").site_url)),{editPost:m}=(0,n.useDispatch)("core/editor");return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(r.PluginSidebarMoreMenuItem,{target:"news-crawler"},"News Crawler"),(0,e.createElement)(r.PluginSidebar,{className:"news-crawler-sidebar",name:"news-crawler",title:"Easy Attachments",icon:"admin-site-alt2"},(0,e.createElement)(a.TextControl,{label:"Site Url",value:i,onChange:e=>{m({meta:{site_url:e}})}}),(0,e.createElement)(a.Button,{isBusy:t,className:"news-crawler-button",variant:"primary",onClick:()=>{l(!0),fetch(`/wp-json/jarvis/v1/feed?url=${i}`,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{console.log(e),o(e),l(!1)})).catch((e=>{console.error(e),alert(e.message),l(!1),o([])}))}},"Get Articles"),(0,e.createElement)(c,{articles:s})))}const{registerPlugin:m}=wp.plugins;m("news-crawler-sidebar",{render:function(){return(0,e.createElement)(i,null)}})})();